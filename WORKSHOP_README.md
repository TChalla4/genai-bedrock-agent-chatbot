# Important

## *** Before deployment you will need the following

1. Use **"us-west-2"** or **"us-east-1"** regions
    - run ```aws configure``` or set the ```~/.aws/credentials``` file
2. **Enable access to all Bedrock models** (Console > Bedrock > Model Access > "Enable all models").
2. Check if you have dependencies by running the below checks. If not continue with steps 4-6.
    - ```aws --version```
    - ```git --version```
    - ```npm --version```
    - ```docker --verison```
3. Ensure **.node.js**. is installed (check node --version)
    - https://nodejs.org/en/download
4. Ensure **.Docker **.is installed and running
    - https://www.docker.com/
5. Install **git**. if necessary and 

Clone the branch: 
    ```git clone https://github.com/awslabs/genai-bedrock-agent-chatbot --branch ds-builders-multimodal-workshop```

## You are now ready to deploy the CDK app
```bash
$ python3 -m venv .venv
```

After the init process completes and the virtualenv is created, you can use the following
step to activate your virtualenv.

```bash
$ source .venv/bin/activate
```

If you are a ```Windows``` platform, you would activate the virtualenv like this:

```powershell
% .venv\Scripts\activate.bat
```

Once the virtualenv is activated, you can install the required dependencies.

```bash
$ pip install -r requirements.txt
```

To add additional dependencies, for example other CDK libraries, just add
them to your `setup.py` file and rerun the `pip install -r requirements.txt`
command.

At this point you can now synthesize the CloudFormation template for this code.

```bash
$ cdk synth
```

To add additional dependencies, for example other CDK libraries, just add
them to your `setup.py` file and rerun the `pip install -r requirements.txt`
command.

You will need to bootstrap it if this is your first time running cdk at a particular account and region.

```bash
$ cdk bootstrap
```

Once it's bootstrapped, you can proceed to deploy cdk.

```bash
$ cdk deploy
```

If this is your first time deploying it, the process may take approximately 30-45 minutes to build several Docker images in ECS (Amazon Elastic Container Service). Please be patient until it's completed. Afterward, it will start deploying the chatbot-stack, which typically takes about 5-8 minutes.

Once the deployment process is complete, you will see the output of the cdk in the terminal, and you can also verify the status in your CloudFormation console.

You can either test the agent in AWS console or through streamlit app url listed in the outputs of chatbot-stack in CloudFormation.

To delete the cdk once you have finished using it to avoid future costs, you can either delete it through the console or execute the following command in the terminal.

```bash
$ cdk destroy
```

You may also need to manually delete the S3 bucket generated by the cdk. Please ensure to delete all the generated resources to avoid incurring costs.

## Useful CDK commands

- `cdk ls` list all stacks in the app
- `cdk synth` emits the synthesized CloudFormation template
- `cdk deploy` deploy this stack to your default AWS account/region
- `cdk diff` compare deployed stack with current state
- `cdk docs` open CDK documentation
- `cdk destroy` dstroys one or more specified stacks



## Resources

- Bedrock Agent deployment - https://github.com/aws-samples/genai-quickstart-pocs/tree/main/amazon-bedrock-claude3-multi-modal-poc

- Multimodal sample - https://github.com/awslabs/genai-bedrock-agent-chatbot

- Llama Index - https://docs.llamaindex.ai/en/stable/examples/index_structs/struct_indices/SQLIndexDemo/


